Bootstrap: localimage
From: containers/petsc.sif

%files
    files/firedrake-install-local /opt/firedrake-install

%post
    export OMPI_DIR=/opt/ompi
    export PATH="$OMPI_DIR/bin:$PATH"
    export LD_LIBRARY_PATH="$OMPI_DIR/lib:$LD_LIBRARY_PATH"
    source /opt/intel/oneapi/setvars.sh
    export PETSC_DIR=/opt/petsc
    export PETSC_ARCH=arch-linux-c-opt

    cd /opt && python3 firedrake-install --no-package-manager --mpiexec=mpiexec --mpicc=mpicc --mpif90=mpif90 --mpicxx=mpicxx --honour-petsc-dir
